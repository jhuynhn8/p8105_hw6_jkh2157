p8105_hw6_jkh2157
================
2025-12-01

# Problem 1

#### Data Cleaning

``` r
homicide_df = 
  read_csv("data/homicide-data.csv") |>
  mutate(
    city_state = str_c(city, state, sep = ", "),
    victim_age = as.numeric(victim_age),
    victim_race = fct_relevel(victim_race, "White")
  ) |>
  filter(
    !(city_state %in% c("Dallas, TX", "Phoenix, AZ", "Kansas City, MO", "Tulsa, AL")),
    victim_race %in% c("White", "Black")
  ) |>
  mutate(resolved = as.numeric(disposition == "Closed by arrest"))
```

    ## Rows: 52179 Columns: 12
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (9): uid, victim_last, victim_first, victim_race, victim_age, victim_sex...
    ## dbl (3): reported_date, lat, lon
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

    ## Warning: There was 1 warning in `mutate()`.
    ## ℹ In argument: `victim_age = as.numeric(victim_age)`.
    ## Caused by warning:
    ## ! NAs introduced by coercion

``` r
#checking to make sure that it correctly dropped those states 

homicide_df |> 
  distinct(city_state) |> 
  filter(city_state %in% c(
    "Dallas, TX",
    "Phoenix, AZ",
    "Kansas City, MO",
    "Tulsa, AL"
  ))
```

    ## # A tibble: 0 × 1
    ## # ℹ 1 variable: city_state <chr>

#### Logistic Regression for Baltimore

``` r
baltimore_df =
  homicide_df |> 
  filter(city_state == "Baltimore, MD")

fit_baltimore =
  baltimore_df |>
  glm(resolved ~ victim_age + victim_race + victim_sex,
      data = _,
      family = binomial())

baltimore_or =
  fit_baltimore |>
  tidy() |>
  mutate(OR = exp(estimate)) |>
  select(term, log_OR = estimate, OR, p.value)

baltimore_or |> 
  filter(term == "victim_sexMale")
```

    ## # A tibble: 1 × 4
    ##   term           log_OR    OR  p.value
    ##   <chr>           <dbl> <dbl>    <dbl>
    ## 1 victim_sexMale -0.854 0.426 6.26e-10

``` r
#creating a nicer table 

baltimore_results =
  fit_baltimore |> 
  tidy() |>
  mutate(
    OR = exp(estimate),
    ci_lower = exp(estimate - 1.96 * std.error),
    ci_upper = exp(estimate + 1.96 * std.error)
  ) |>
  filter(term == "victim_sexMale") |>
  select(
    term,
    log_OR = estimate,
    OR,
    ci_lower,
    ci_upper,
    p.value
  )

baltimore_results |> 
  knitr::kable(digits = 3)
```

| term           | log_OR |    OR | ci_lower | ci_upper | p.value |
|:---------------|-------:|------:|---------:|---------:|--------:|
| victim_sexMale | -0.854 | 0.426 |    0.325 |    0.558 |       0 |

**Interpretation**: Holding age and race constant, male victims have
significantly lower odds of having their homicide solved compared to
female victims. The adjusted odds ratio is 0.43, indicating that the
odds of case resolution for male victims are about 57% lower than for
female victims. The association is also statistically significant
(p\<0.0001)

#### Linear Regression for other cities: Using nest and map

``` r
city_results =
  homicide_df |> 
  nest(data = -city_state) |>
  mutate(
    models = map(data, \(df)
      glm(resolved ~ victim_age + victim_race + victim_sex,
          data = df,
          family = binomial())
    ),
    results = map(models, tidy)
  ) |>
  select(-data, -models) |>
  unnest(results) |>
  mutate(OR = exp(estimate)) |>
  filter(term == "victim_sexMale") |>
  group_by(city_state) |>
  mutate(
    ci_lower = exp(estimate - 1.96 * std.error),
    ci_upper = exp(estimate + 1.96 * std.error)
  ) |>
  ungroup()

#creating nicer tables 
city_results_table =
  city_results |> 
  select(
    city_state,
    log_OR = estimate,
    OR,
    ci_lower,
    ci_upper,
    p.value
  ) |>
  arrange(OR)

city_results_table |> 
  knitr::kable(digits = 3)
```

| city_state         | log_OR |    OR | ci_lower | ci_upper | p.value |
|:-------------------|-------:|------:|---------:|---------:|--------:|
| New York, NY       | -1.338 | 0.262 |    0.138 |    0.499 |   0.000 |
| Baton Rouge, LA    | -0.964 | 0.381 |    0.209 |    0.695 |   0.002 |
| Omaha, NE          | -0.961 | 0.382 |    0.203 |    0.721 |   0.003 |
| Cincinnati, OH     | -0.917 | 0.400 |    0.236 |    0.677 |   0.001 |
| Chicago, IL        | -0.891 | 0.410 |    0.336 |    0.501 |   0.000 |
| Long Beach, CA     | -0.891 | 0.410 |    0.156 |    1.082 |   0.072 |
| San Diego, CA      | -0.884 | 0.413 |    0.200 |    0.855 |   0.017 |
| Baltimore, MD      | -0.854 | 0.426 |    0.325 |    0.558 |   0.000 |
| Pittsburgh, PA     | -0.842 | 0.431 |    0.265 |    0.700 |   0.001 |
| Denver, CO         | -0.736 | 0.479 |    0.236 |    0.971 |   0.041 |
| Louisville, KY     | -0.712 | 0.491 |    0.305 |    0.790 |   0.003 |
| Philadelphia, PA   | -0.701 | 0.496 |    0.378 |    0.652 |   0.000 |
| San Bernardino, CA | -0.692 | 0.500 |    0.171 |    1.462 |   0.206 |
| Miami, FL          | -0.663 | 0.515 |    0.304 |    0.872 |   0.013 |
| Buffalo, NY        | -0.653 | 0.521 |    0.290 |    0.935 |   0.029 |
| Columbus, OH       | -0.630 | 0.532 |    0.378 |    0.750 |   0.000 |
| Oakland, CA        | -0.574 | 0.563 |    0.365 |    0.868 |   0.009 |
| Detroit, MI        | -0.541 | 0.582 |    0.462 |    0.734 |   0.000 |
| New Orleans, LA    | -0.536 | 0.585 |    0.422 |    0.811 |   0.001 |
| San Francisco, CA  | -0.498 | 0.608 |    0.317 |    1.165 |   0.134 |
| Los Angeles, CA    | -0.413 | 0.662 |    0.458 |    0.956 |   0.028 |
| Sacramento, CA     | -0.402 | 0.669 |    0.335 |    1.337 |   0.255 |
| Fort Worth, TX     | -0.402 | 0.669 |    0.397 |    1.127 |   0.131 |
| Boston, MA         | -0.395 | 0.674 |    0.356 |    1.276 |   0.226 |
| Washington, DC     | -0.371 | 0.690 |    0.468 |    1.017 |   0.061 |
| St. Louis, MO      | -0.352 | 0.703 |    0.530 |    0.932 |   0.014 |
| San Antonio, TX    | -0.350 | 0.705 |    0.398 |    1.249 |   0.230 |
| Houston, TX        | -0.341 | 0.711 |    0.558 |    0.907 |   0.006 |
| Jacksonville, FL   | -0.329 | 0.720 |    0.537 |    0.966 |   0.028 |
| Memphis, TN        | -0.324 | 0.723 |    0.529 |    0.988 |   0.042 |
| Milwaukee, wI      | -0.319 | 0.727 |    0.499 |    1.060 |   0.098 |
| Tampa, FL          | -0.214 | 0.808 |    0.348 |    1.876 |   0.619 |
| Durham, NC         | -0.208 | 0.812 |    0.392 |    1.683 |   0.576 |
| Las Vegas, NV      | -0.178 | 0.837 |    0.608 |    1.154 |   0.278 |
| Savannah, GA       | -0.143 | 0.867 |    0.422 |    1.780 |   0.697 |
| Birmingham, AL     | -0.139 | 0.870 |    0.574 |    1.318 |   0.511 |
| Charlotte, NC      | -0.123 | 0.884 |    0.557 |    1.403 |   0.600 |
| Indianapolis, IN   | -0.085 | 0.919 |    0.679 |    1.242 |   0.582 |
| Minneapolis, MN    | -0.054 | 0.947 |    0.478 |    1.875 |   0.876 |
| Oklahoma City, OK  | -0.026 | 0.974 |    0.624 |    1.520 |   0.908 |
| Tulsa, OK          | -0.025 | 0.976 |    0.614 |    1.552 |   0.917 |
| Atlanta, GA        |  0.000 | 1.000 |    0.684 |    1.463 |   1.000 |
| Richmond, VA       |  0.006 | 1.006 |    0.498 |    2.033 |   0.987 |
| Nashville, TN      |  0.034 | 1.034 |    0.685 |    1.562 |   0.873 |
| Fresno, CA         |  0.289 | 1.335 |    0.580 |    3.071 |   0.496 |
| Stockton, CA       |  0.301 | 1.352 |    0.621 |    2.942 |   0.447 |
| Albuquerque, NM    |  0.570 | 1.767 |    0.831 |    3.761 |   0.139 |
